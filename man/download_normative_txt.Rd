% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/download_normative_txt.R
\name{download_normative_txt}
\alias{download_normative_txt}
\title{Download normative texts from the Brazil Central Bank (BCB) from a reference data.frame}
\usage{
download_normative_txt(normative_data)
}
\arguments{
\item{normative_data}{data.frame. A data.frame with at least the columns:
\itemize{
\item TipodoNormativoOWSCHCS: type of the normative (e.g., "Comunicado", "Ato de Diretor", etc.)
\item NumeroOWSNMBR: number/identifier of the normative to be queried.
\item Typically the result of a prior query (e.g., via \code{download_normative_data}).
}}
}
\value{
data.frame with the records returned by the API for each reference in \code{normative_data},
including the extracted and post-processed fields (e.g., \code{Assunto}, \code{Texto}).
}
\description{
\ifelse{html}{\href{https://lifecycle.r-lib.org/articles/stages.html#superseded}{\figure{lifecycle-superseded.svg}{options: alt='[Superseded]'}}}{\strong{[Superseded]}}

For each row of the input data.frame, constructs the appropriate URL for the BCB
normatives API, performs the request, extracts the returned content and applies
basic cleaning to the text fields (Assunto and Texto). Returns a data.frame
with all aggregated contents.
}
\details{
The function performs the following steps:
\enumerate{
\item Iterates over each row of \code{normative_data} (prints the iteration index for monitoring).
\item Encodes the normative type for URL usage (using \code{URLencode(..., reserved = TRUE)}).
\item Chooses the API route depending on the type:
\itemize{
\item for "Comunicado", "Ato de Diretor" and "Ato do Presidente" it uses the other-norms endpoint (\code{exibeoutrasnormas});
\item for the rest, it uses the standard normative endpoint (\code{exibenormativo}).
}
\item Makes the HTTP request (via \code{httr::GET}) and converts the returned JSON into a data.frame.
\item Extracts and cleans textual fields:
\itemize{
\item converts HTML to plain text for the fields \code{Assunto} and \code{Texto} (using \code{xml2::read_html} + \code{xml2::xml_text}),
\item removes line breaks and extra spaces (\code{stringr::str_replace_all}, \code{stringr::str_squish}).
}
\item Aggregates each result into a final data.frame returned by the function.
}
}
\note{
\itemize{
\item The function assumes the BCB API returns a \code{conteudo} field with the expected fields.
\item Request errors or changes in the API structure may cause failures; consider handling exceptions around the call if needed.
\item Packages used internally: \code{httr}, \code{jsonlite}, \code{xml2}, \code{stringr}, \code{dplyr}, \code{glue}, \code{purrr}.
}
}
\examples{
\dontrun{
# First, download normative data
normative_data <- download_normative_data(
   "Cooperativa",
    "2023-08-01",
    "2025-08-01")
# Then, download the full texts for the retrieved normatives
normative_txt <- download_normative_txt(normative_data)
}

}
