% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/download_normative_txt.R
\name{download_normative_txt}
\alias{download_normative_txt}
\title{Baixa texto de normativos do Banco Central (BCB) a partir de um data.frame de referências}
\usage{
download_normative_txt(normative_data)
}
\arguments{
\item{normative_data}{data.frame. Data.frame com pelo menos as colunas:
\itemize{
\item TipodoNormativoOWSCHCS: tipo do normativo (ex.: "Comunicado", "Ato de Diretor", etc.)
\item NumeroOWSNMBR: número/identificador do normativo a ser consultado.
\item É o resultado de uma consulta prévia (p.ex., via \code{download_normative_data}).
}}
}
\value{
data.frame com os registros retornados pela API para cada referência em \code{normative_data},
incluindo os campos extraídos e pós-processados (p.ex. \code{Assunto}, \code{Texto}).
}
\description{
\ifelse{html}{\href{https://lifecycle.r-lib.org/articles/stages.html#superseded}{\figure{lifecycle-superseded.svg}{options: alt='[Superseded]'}}}{\strong{[Superseded]}}
}
\details{
Para cada linha do data.frame de entrada, monta a URL apropriada à API de normativos
do BCB, realiza a requisição, extrai o conteúdo retornado e faz limpeza básica dos
campos de texto (Assunto e Texto). Retorna um data.frame com todos os conteúdos agregados.

A função realiza os seguintes passos:
\enumerate{
\item Itera por cada linha de \code{normative_data} (imprime o índice da iteração para acompanhamento).
\item Codifica o tipo do normativo para uso em URL (usando \code{URLencode(..., reserved = TRUE)}).
\item Seleciona a rota da API conforme o tipo:
\itemize{
\item para "Comunicado", "Ato de Diretor" e "Ato do Presidente" usa o endpoint de
outras normas (\code{exibeoutrasnormas});
\item para os demais, usa o endpoint de normativo padrão (\code{exibenormativo}).
}
\item Faz a requisição HTTP (via \code{httr::GET}) e converte o JSON retornado em data.frame.
\item Extrai e limpa os campos textuais:
\itemize{
\item converte HTML em texto plano para os campos \code{Assunto} e \code{Texto} (usando \code{xml2::read_html} + \code{xml2::xml_text}),
\item remove quebras de linha e excesso de espaços (\code{stringr::str_replace_all}, \code{stringr::str_squish}).
}
\item Agrega cada resultado em um data.frame final retornado pela função.
}
}
\note{
\itemize{
\item A função pressupõe que a API do BCB retorna um campo \code{conteudo} com os campos esperados.
\item Erros de requisição ou alterações na estrutura da API podem causar falhas; trate possíveis exceções
ao redor da chamada se necessário.
\item Pacotes usados internamente: \code{httr}, \code{jsonlite}, \code{xml2}, \code{stringr}, \code{dplyr}, \code{glue}, \code{purrr}.
}
}
\examples{
\dontrun{
# Exemplo mínimo
normative_data <- data.frame(
  TipodoNormativoOWSCHCS = c("Comunicado", "Circular"),
  NumeroOWSNMBR = c("123", "456"),
  stringsAsFactors = FALSE
)
normative_txt <- download_normative_txt(normative_data)
}

}
